<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Biodiversity Modelling Summer School 2021: Review of the algorithm of a Gibbs Sampler</title>
  
  
  
  <meta name="article:author" content="Andrew MacDonald"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Biodiversity Modelling Summer School 2021: Review of the algorithm of a Gibbs Sampler"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Biodiversity Modelling Summer School 2021"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Biodiversity Modelling Summer School 2021: Review of the algorithm of a Gibbs Sampler"/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","output"]}},"value":[{"type":"character","attributes":{},"value":["Review of the algorithm of a Gibbs Sampler"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Andrew MacDonald"]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }
  
  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .distill-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .distill-site-nav {
      display: none;
    }
  }
  
  .distill-site-header {
  
  }
  
  .distill-site-footer {
  
  }
  
  
  /* Site Header */
  
  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }
  
  .distill-site-header .logo {
    padding: 0;
  }
  
  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .distill-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }
  
  </style>
  
  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>
  
  <script type="application/javascript">
  
  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }
  
  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }
  
  function createFuseIndex() {
  
    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);
  
    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });
  
        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }
  
  window.document.addEventListener("DOMContentLoaded", function (event) {
  
    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;
  
    createFuseIndex()
      .then(function(fuse) {
  
        // make search box visible
        searchEl.classList.remove('hidden');
  
        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });
  
  });
  
  </script>
  
  <style type="text/css">
  
  .nav-search {
    font-size: x-small;
  }
  
  /* Algolioa Autocomplete */
  
  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }
  
  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }
  
  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }
  
  </style>
  
  
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }
  
  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }
  
  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }
  
  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }
  
  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }
  
  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }
  
  d-article h3 {
    margin-top: 1.5rem;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  /* Tweak code blocks */
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }
  
  d-article div.sourceCode {
    background-color: white;
  }
  
  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  d-article pre a {
    border-bottom: none;
  }
  
  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }
  
  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }
  
  @media(min-width: 768px) {
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }
  
  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }
  
  d-article pre {
    font-size: 14px;
  }
  
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for d-contents */
  
  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }
  
  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }
  
  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }
  
  .d-contents li {
    list-style-type: none
  }
  
  .d-contents nav > ul {
    padding-left: 0;
  }
  
  .d-contents ul {
    padding-left: 1em
  }
  
  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }
  
  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }
  
  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }
  
  .d-contents nav > ul > li > a {
    font-weight: 600;
  }
  
  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }
  
  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }
  
  
  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }
  
  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }
  
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  /* Citations */
  
  d-article .citation {
    color: inherit;
    cursor: inherit;
  }
  
  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }
  
  /* Citation hover box */
  
  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }
  
  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Include appendix styles here so they can be overridden */
  
  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }
  
  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }
  
  d-appendix h3 + * {
    margin-top: 1em;
  }
  
  d-appendix ol {
    padding: 0 0 0 15px;
  }
  
  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }
  
  d-appendix li {
    margin-bottom: 1em;
  }
  
  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  d-appendix > * {
    grid-column: text;
  }
  
  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }
  
  /* Include footnote styles here so they can be overridden */
  
  d-footnote-list {
    contain: layout style;
  }
  
  d-footnote-list > * {
    grid-column: text;
  }
  
  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }
  
  
  
  /* Anchor.js */
  
  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }
  
  /* Styles for posts lists (not auto-injected) */
  
  
  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }
  
  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }
  
  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }
  
  .post-preview-last {
    border-bottom: none !important;
  }
  
  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }
  
  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }
  
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }
  
  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }
  
  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }
  
  .posts-list .metadata > * {
    display: inline-block;
  }
  
  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }
  
  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }
  
  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }
  
  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  .posts-list img {
    opacity: 1;
  }
  
  .posts-list img[data-src] {
    opacity: 0;
  }
  
  .posts-more {
    clear: both;
  }
  
  
  .posts-sidebar {
    font-size: 16px;
  }
  
  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }
  
  .sidebar-section {
    margin-bottom: 30px;
  }
  
  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }
  
  .categories li>a {
    border-bottom: none;
  }
  
  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }
  
  .categories .active {
    font-weight: 600;
  }
  
  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }
  
  
  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  .downlevel .posts-list .post-preview {
    color: inherit;
  }
  
  
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }
  
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();
  
    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-contents').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <style type="text/css">
  /* base variables */
  
  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */
  
  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */
  
  
  
  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }
  
  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }
  
  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }
  
  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }
  
  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */
  
  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }
  
  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }
  
  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base variables */
  
  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */
  
  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */
  
  @import url('https://fonts.googleapis.com/css2?family=Roboto');
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP');
  
  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       15px;
    --code-size:       15px;
    --aside-size:      10px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    'Roboto', sans-serif;
    --mono-font:       monospace;
    --body-font:       'Noto Sans JP', sans-serif;
    --navbar-font:     'Roboto', sans-serif;  /* websites + blogs only */
  }
  
  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.9rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }
  
  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }
  
  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }
  
  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */
  
  .distill-site-header {
    --title-size:       20px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0D98BA;
  }
  
  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }
  
  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base style */
  
  /* FONT FAMILIES */
  
  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }
  
  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }
  
  
  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }
  
  d-title h1 {
    font-size: var(--title-size, 50px);
  }
  
  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }
  
  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }
  
  
  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }
  
  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }
  
  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }
  
  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }
  
  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }
  
  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }
  
  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }
  
  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }
  
  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }
  
  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }
  
  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }
  
  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }
  
  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }
  
  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }
  
  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }
  
  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }
  
  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }
  
  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Review of the algorithm of a Gibbs Sampler","authors":[{"author":"Andrew MacDonald","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">Biodiversity Modelling Summer School 2021</a>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="about.html">About</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Review of the algorithm of a Gibbs Sampler</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  Andrew MacDonald  
  

</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#why-we-do-what-we-do">Why we do what we do</a></li>
<li><a href="#mcmc-in-general">MCMC in general</a><ul>
<li><a href="#the-metropolis-algorithm">The Metropolis Algorithm</a><ul>
<li><a href="#metropolis-demo-the-mean-of-the-normal-distribution">Metropolis demo: the mean of the Normal Distribution</a></li>
<li><a href="#the-weakness-of-metropolis">The weakness of Metropolis</a></li>
</ul></li>
<li><a href="#metropolis-hastings-algorithm-asymmetrical-jumps">Metropolis-Hastings Algorithm – asymmetrical jumps</a><ul>
<li><a href="#proposal-distribution">Proposal distribution</a></li>
<li><a href="#code-for-metropolis-hastings">Code for Metropolis Hastings</a></li>
</ul></li>
<li><a href="#one-weird-trick-to-make-calculating-the-posterior-easy">One Weird Trick to make calculating the posterior easy</a><ul>
<li><a href="#mean-of-a-normal-distribution">Mean of a Normal Distribution</a></li>
<li><a href="#variance-of-the-normal-distribution">Variance of the Normal Distribution</a></li>
</ul></li>
<li><a href="#gibbs-sampling">Gibbs sampling</a><ul>
<li><a href="#gibbs-demo-with-the-normal-distribution">Gibbs demo with the Normal Distribution</a></li>
<li><a href="#defining-and-running-a-gibbs-sampler">Defining and running a Gibbs Sampler</a></li>
</ul></li>
<li><a href="#metropolis-in-gibbs">Metropolis-in-Gibbs</a></li>
</ul></li>
<li><a href="#bonus-zone">Bonus Zone</a><ul>
<li><a href="#conjugate-priors-metropolis-hastings-and-penguins">Conjugate priors, Metropolis-Hastings, and Penguins</a><ul>
<li><a href="#proof-of-beta-binomial-conjugate-pair">Proof of Beta &amp; Binomial conjugate pair</a></li>
<li><a href="#sampling-this-model-the-metropolis-algorithm">Sampling this model: the Metropolis algorithm</a></li>
<li><a href="#application-clutch-success-in-the-palmer-penguins">Application: Clutch success in the Palmer Penguins</a></li>
</ul></li>
<li><a href="#three-parameters-at-once">Three parameters at once</a></li>
<li><a href="#metropolis-hastings-and-gibbs-at-the-same-time">Metropolis hastings and gibbs at the same time</a></li>
<li><a href="#clara-coffee-example">Clara Coffee Example</a></li>
</ul></li>
</ul>
</nav>
</div>
<style>
div.blue { background-color: #0D98BA; border-radius: 5px; padding: 20px;}
</style>
<h2 id="why-we-do-what-we-do">Why we do what we do</h2>
<p>In bayesian statistics we use probability distributions to measure uncertainty about the parameter values we care about.</p>
<p>Because we measure uncertainty with probability, that means we work in probability distributions. We begin with distributions, and we end with distributions. The beginning distributions express all we want to say about what our parameters are. They come first, and are called the “prior” distributions. After we collect data and apply some model to relate it, we find ourselves with a new set of distributions. Because these come <em>after</em> the process of data collection and model creation, this is called the “posterior”.</p>
<p>This means we are applying Bayes rule. This shows us how to update our priors to reflect what we learned from the experiment and model building:</p>
<p><span class="math display">\[
\begin{align}
[\theta_1, \theta_2 | \bf y] &amp;\propto [\theta_1, \theta_2, \bf y] \\
&amp;\propto  [\bf y | \theta_1, \theta_2][\theta_1][\theta_2] \\
\end{align}
\]</span></p>
<div class="blue">
<p>Refreshing questions:</p>
<ul>
<li>which of these is the likelihood? Which is the prior?</li>
<li>why is it OK to use something <em>proportional to</em> (<span class="math inline">\(\propto\)</span>) what we want?</li>
</ul>
</div>
<p>The whole goal here is to get this posterior distribution. There are many ways to do this! This workshop is about some of them.</p>
<ul>
<li><strong>Conjugate priors</strong> – works for 1-parameter problems. Gives you the literal equation of the posterior distribution. Only directly useful for very simple problems. Becomes the absolute star of the show with Gibbs Sampling.</li>
<li><strong>Laplace Approximation</strong> – very handy, useful best guess for many multi-parameter models; we’re not doing it.</li>
<li><strong>Metropolis</strong> – A venerable classic for sampling simple models. You have to propose random “jumps” around the distribution, and these need to be symmetric</li>
<li><strong>Metropolis-Hastings</strong> – same as Metropolis, but the jumps get to be <em>asymmetric</em>.</li>
<li><strong>Gibbs sampling</strong> – A wonderful technique for simplifying complex problems. Requires that priors be chosen to make conjugate pairs with likelihoods.</li>
<li><strong>Metropolis-in-Gibbs</strong> – is a Deluxe Combo of the previous two.</li>
<li><strong>HMC etc</strong> – Hamiltonian Monte Carlo is an advanced modern way of doing the same thing. Sets you free to use the priors that work for your question, not the ones that work for your math.</li>
</ul>
<h1 id="mcmc-in-general">MCMC in general</h1>
<p>The objective of MCMC algorithm is to sample parameters from a complex posterior distribution.</p>
<p>Rather than measure the <em>absolute</em> probability of different parameter values:</p>
<p><span class="math display">\[
[\theta|y] = \frac{[y|\theta][\theta]}{[y]}
\]</span></p>
<p>we sample, and evaluate the <em>relative</em> probability of two possible parameter values:</p>
<p><span class="math display">\[
\frac{[\theta^{new}|y]}{[\theta^k|y]} = \frac{[y|\theta^{new}][\theta^{new}]}{[y|\theta^k][\theta^k]}
\]</span></p>
<p>In this way, we can sample a probability distribution ( <span class="math inline">\([\theta|y]\)</span> ) using only something <em>proportional</em> to that distribution ( <span class="math inline">\([y|\theta][\theta]\)</span> ). Put another way, we can’t get an equation, so we use interesting numerical tricks to jump straight to a histogram.</p>
<h2 id="the-metropolis-algorithm">The Metropolis Algorithm</h2>
<p><strong>STEP 1</strong> Draw <span class="math inline">\(\theta^{new}\)</span> from a <em>symmetric</em> distribution centered on <span class="math inline">\(\theta^{k}\)</span> (i.e. in the <span class="math inline">\(k\)</span>th interation, the current value) e.g. <span class="math inline">\(\theta^{new} \sim N(\theta^{k}, \sigma_{tune})\)</span></p>
<p><strong>STEP 2</strong> Calculate the ratio R:</p>
<p><span class="math display">\[
R = \text{min}\left( 1, \frac{[y|\theta^{new}][\theta^{new}]}{[y|\theta^k][\theta^k]}\right)
\]</span></p>
<p>This is the probability of acceptance. In other words, if the ratio is greater than one, that means the proposal is for a more probable value. We’ll always take it. If the ratio is less than 1, that means the new proposal is less probable than the value we have already. However, there’s a chance we’ll take it anyway.</p>
<p><strong>STEP 3</strong> Test to see if <code>runif(1, min=0, max=1)</code> <span class="math inline">\(&lt; R\)</span>. if so, set <span class="math inline">\(\theta^{k + 1} = \theta^{new}\)</span></p>
<div class="blue">
<p>Why should we accept “worse” parameter values? Why is it good to sometimes stay in the same place?</p>
</div>
<h3 id="metropolis-demo-the-mean-of-the-normal-distribution">Metropolis demo: the mean of the Normal Distribution</h3>
<p>Let’s simulate some data from a normal distribution.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1859</span><span class='op'>)</span>
<span class='va'>M_true_mean</span> <span class='op'>&lt;-</span> <span class='fl'>50</span>
<span class='va'>correct_sd</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>
<span class='va'>weights</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>300</span>, mean <span class='op'>=</span> <span class='va'>M_true_mean</span>, sd <span class='op'>=</span> <span class='va'>correct_sd</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>weights</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 48.23651 45.77398 48.84943 47.19116 50.31188 52.54827</code></pre>
</div>
<p>One possible model for these data could be:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Normal}(\mu, 3) \\
\mu &amp;\sim \text{Normal(40, 10)}
\end{align}
\]</span></p>
<p><strong>NOTE:</strong> We <strong>assume we KNOW the standard deviation</strong>. In this case, it is exactly 3. This is just for illustration. Later we will see what to do if you have multiple parameters.</p>
<p>To set up a Metropolis sampler, we’ll start by defining four useful functions:</p>
<ol type="1">
<li>A function which returns the <em>log-likelihood</em> of our data. As you recall, the likelihood of one datapoint is the probability of sampling that datapoint from a distribution, given specific known parameters. The likelihood of the data is the probability of observing ALL the datapoints. We assume the observations are independent, so we multiply the probability of each datapoint to get the probability of the whole dataset. Because we’re working on the log scale, instead of multiplication we just use addition.</li>
<li>a proposal function. This makes new values to try at each iteration of the Markov Chain. Here we’ll use a symmetric proposal function, the uniform distribution.</li>
<li>A convenience function to add the log-likelihood and the prior together – this gives us the numerator of the Bayes formula.</li>
<li>finally, a function which puts it all together and spits out the probability of acceptance. Because this is a probability, we use <code>exp()</code> to convert from log-likelihood values back to probability.</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## define likelihoods for our problem</span>
<span class='va'>MEAN_normal_loglike</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data_vec</span>, <span class='va'>mean_value</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='va'>data_vec</span>, mean <span class='op'>=</span> <span class='va'>mean_value</span>, sd <span class='op'>=</span> <span class='fl'>3</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># proposal function to make new parameter values.</span>
<span class='va'>M_propose_new_val</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>old_value</span>, <span class='va'>tune</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1</span>, min <span class='op'>=</span> <span class='va'>old_value</span> <span class='op'>-</span> <span class='va'>tune</span>, max <span class='op'>=</span> <span class='va'>old_value</span> <span class='op'>+</span> <span class='va'>tune</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## function to use these to calculate the value of the numerator in Bayes Formula</span>
<span class='co'>## We are working on the LOG scale, so we have to ADD these together</span>
<span class='va'>numerator</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>value</span>, <span class='va'>data</span><span class='op'>)</span>  <span class='op'>{</span>
  <span class='co'># likelihood</span>
  <span class='va'>log_like</span> <span class='op'>&lt;-</span> <span class='fu'>MEAN_normal_loglike</span><span class='op'>(</span>data_vec <span class='op'>=</span> <span class='va'>data</span>, mean_value <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span>
  <span class='co'># prior</span>
  <span class='va'>log_prior</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span>, mean <span class='op'>=</span> <span class='fl'>40</span>, sd <span class='op'>=</span> <span class='fl'>10</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>log_like</span> <span class='op'>+</span> <span class='va'>log_prior</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## function to calculate the acceptance ratio</span>
<span class='va'>M_accept_probability</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>new_value</span>, 
                               <span class='va'>old_value</span>, 
                               <span class='va'>data_to_use</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='co'># working on the LOG scale so we SUBTRACT values (the same as dividing these two things)</span>
  <span class='va'>new</span> <span class='op'>&lt;-</span> <span class='fu'>numerator</span><span class='op'>(</span>value <span class='op'>=</span> <span class='va'>new_value</span>, data <span class='op'>=</span> <span class='va'>data_to_use</span><span class='op'>)</span>
  <span class='va'>old</span> <span class='op'>&lt;-</span> <span class='fu'>numerator</span><span class='op'>(</span>value <span class='op'>=</span> <span class='va'>old_value</span>, data <span class='op'>=</span> <span class='va'>data_to_use</span><span class='op'>)</span>
  
  <span class='va'>difference_log_scale</span> <span class='op'>&lt;-</span> <span class='va'>new</span> <span class='op'>-</span> <span class='va'>old</span>
  
  <span class='co'># use EXP to undo the LOG -- convert back to probability</span>
  <span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>difference_log_scale</span><span class='op'>)</span>
  
  <span class='va'>p_accept</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>r</span><span class='op'>)</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>p_accept</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Now that we’ve set up our functions, we use a for-loop to run the Markov chain:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># set tune parameter</span>
<span class='va'>tune_parameter</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='co'># how long should the chain be? </span>
<span class='va'>n_samples</span> <span class='op'>&lt;-</span> <span class='fl'>5000</span>

<span class='co'>#start chain</span>
<span class='va'>mean_chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_samples</span><span class='op'>)</span>

<span class='co'># start value</span>
<span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>30</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>2</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='va'>old_val</span> <span class='op'>&lt;-</span> <span class='va'>mean_chain</span><span class='op'>[</span><span class='va'>i</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>]</span>
  
  <span class='va'>new_val</span> <span class='op'>&lt;-</span> <span class='fu'>M_propose_new_val</span><span class='op'>(</span>old_value <span class='op'>=</span> <span class='va'>old_val</span>, tune <span class='op'>=</span> <span class='va'>tune_parameter</span><span class='op'>)</span>
  
  <span class='va'>p_accept</span> <span class='op'>&lt;-</span> <span class='fu'>M_accept_probability</span><span class='op'>(</span>new_value <span class='op'>=</span> <span class='va'>new_val</span>,
                                 old_value <span class='op'>=</span> <span class='va'>old_val</span>, 
                                 data_to_use <span class='op'>=</span> <span class='va'>weights</span><span class='op'>)</span>
  
  <span class='va'>mean_chain</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='va'>p_accept</span>, <span class='va'>new_val</span>, <span class='va'>old_val</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>We can plot the chain iterations to get a first look at our results. This is called a “trace plot”:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-4-1.png" alt="Trace plot of samples from one Metropolis algorithm" width="624" />
<p class="caption">
Figure 1: Trace plot of samples from one Metropolis algorithm
</p>
</div>
</div>
<p>This shows the long road that our sampler takes to get from the starting value to the true mean. For this reason, typically we drop the beginning of the chain. These dropped samples are called the “burn in” period.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span>, type <span class='op'>=</span> <span class='st'>"l"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<p>This shows the “fuzzy caterpillar” shape of a good, healthy Markov Chain.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>M_true_mean</span>, col <span class='op'>=</span> <span class='st'>"green"</span>, lwd <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-6-1.png" width="624" /></p>
</div>
<p>The green line shows the true average, which is close to the real value!</p>
<h3 id="the-weakness-of-metropolis">The weakness of Metropolis</h3>
<p>Metropolis sampling will work, but sometimes we use MUCH more computer power than we need. Let’s see how many proposals are rejected in our sampling.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rejects</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/zapsmall.html'>zapsmall</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='op'>(</span><span class='va'>n_samples</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>)</span>
<span class='co'># </span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>rejects</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-7"></span>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-7-1.png" alt="Rejection in the Metropolis algorithm. here values of 0 mean that the sampler kept the same value. " width="624" />
<p class="caption">
Figure 2: Rejection in the Metropolis algorithm. here values of 0 mean that the sampler kept the same value.
</p>
</div>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># </span>
<span class='va'>n_rejects</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>rejects</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span>  <span class='op'>/</span> <span class='va'>n_samples</span>
</code></pre>
</div>
</div>
<p>We rejected 86.18% of the values we tried. That’s not very efficient! Soon we’ll see a more efficient way to do this.</p>
<h2 id="metropolis-hastings-algorithm-asymmetrical-jumps">Metropolis-Hastings Algorithm – asymmetrical jumps</h2>
<p><em>See the <a href="https://bios2.github.io/biodiversity_modelling_2021/slides/12_Bayes#49">slides on this part here</a></em></p>
<p>The same, but we can use an asymmetrical proposal distribution. This means that we can jump in either direction, but one direction is more likely. We need this, because sometimes our parameters are bounded! For example, the standard deviation of a normal distribution can never be negative.</p>
<p>Because our jumps are no longer symmetrical, we need to add a correction factor to our acceptance probability. Now, in addition to the Likelihood and Prior, we have the Candidate distribution getting involved:</p>
<p><span class="math display">\[
r = \frac{[y|\theta^{new}][\theta^{new}][\theta^{old}|\theta^{new}]}
{[y|\theta^{old}][\theta^{old}][\theta^{old}|\theta^{new}]}
\]</span></p>
<p>Here’s the same expression, but with more words substituted as a guide:</p>
<p><span class="math display">\[
r = \frac{\text{Likelihood}(\text{data}|\theta^{new}) \times \text{Prior}(\theta^{new}, \alpha, \beta) \times \text{Candidate}(\theta^{old}, \mu = \theta^{new}, \sigma_{tune})}{\text{Likelihood}(\text{data}|\theta^{old}) \times \text{Prior}(\theta^{old}, \alpha, \beta)\times \text{Candidate}(\theta^{new}, \mu = \theta^{old}, \sigma_{tune})}
\]</span></p>
<p>once we have <span class="math inline">\(r\)</span>, we can get the probability of acceptance, <span class="math inline">\(R\)</span>, same as above (in the Metropolis algorithm):</p>
<p><span class="math display">\[
R = \text{min}( 1, r)
\]</span></p>
<p>Let’s go (back) to our Normal weights example and try this out.</p>
<div class="blue">
<p><strong>NOTE: We have to assume we KNOW the mean</strong>. Later we’ll see examples of what to do if you want to find two or more numbers at once!</p>
</div>
<p>Our model will be:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Normal}(50, \sigma) \\
\sigma &amp;\sim \text{Gamma}\left(\frac{4^2}{3^2}, \frac{4}{3^2}\right)\\
\end{align}
\]</span></p>
<p>Why this weird notation for the gamma distribution?<br />
Here I’m using a classic trick called moment matching. We do this because for almost all distributions with two parameters, the mean and standard deviation each depend on both parameters. This means that each parameter is also a function of both the mean and the standard deviation. That means we can’t directly set the mean and variance of a distribution with one parameter each.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Instead, we “reparameterize” the distribution, which just means we use values that correspond to the average and the standard deviation (or something like it). This is really helpful when you’re using these distributions for ecology!</p>
<p>for mean <span class="math inline">\(\mu\)</span> and standard devation <span class="math inline">\(\sigma\)</span>, the Gamma distribution parameters are:</p>
<p><span class="math display">\[
\text{Gamma}\left(\frac{\mu^2}{\sigma^2}, \frac{\mu}{\sigma^2}\right)
\]</span></p>
<p>here’s a quick demo to convince you:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rand_gammas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>500</span>, shape <span class='op'>=</span> <span class='fl'>4</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span>, rate <span class='op'>=</span> <span class='fl'>4</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>rand_gammas</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-8-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>rand_gammas</span><span class='op'>)</span> <span class='co'># close to 4</span>
</code></pre>
</div>
<pre><code>[1] 3.921929</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>rand_gammas</span><span class='op'>)</span> <span class='co'># close to 3</span>
</code></pre>
</div>
<pre><code>[1] 2.949357</code></pre>
</div>
<h3 id="proposal-distribution">Proposal distribution</h3>
<p>We also need a distribution for the <em>proposals</em> we will try in the algorithm. This distribution should be above 0, since we can’t have a 0 variance. The lognormal is a good choice (and is hopefully clear since it is not the same distribution as the gamma)</p>
<p>What does <span class="math inline">\(\text{lognormal}(2, 0.2)\)</span> look like?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Lognormal.html'>rlnorm</a></span><span class='op'>(</span><span class='fl'>500</span>, <span class='fl'>2</span>, <span class='fl'>.2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<h3 id="code-for-metropolis-hastings">Code for Metropolis Hastings</h3>
<p>Let’s do Metropolis Hastings. We begin as before, with an expression for the numerator of Bayes Rule:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## define likelihoods for our problem</span>
<span class='va'>MH_normal_loglike</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data_vec</span>, <span class='va'>sd_value</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='va'>data_vec</span>, mean <span class='op'>=</span> <span class='fl'>50</span>, sd <span class='op'>=</span> <span class='va'>sd_value</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>######## ~~~!!!!!!!!!!!!!~~~~~~#########</span>
<span class='co'>## NOTE that the mean gets logged as it goes into rlnorm and dlnorm!! </span>
<span class='co'>## This is a very necessary detail </span>
<span class='co'>## read the help files (?rlnorm) to find out what the R functions expect</span>
<span class='co'>######## ~~~!!!!!!!!!!!!!~~~~~~#########</span>

<span class='co'># proposal function to make new parameter values.</span>
<span class='va'>MH_propose_new_val</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>old_value</span>, <span class='va'>sig_tune</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/Lognormal.html'>rlnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, mean <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>old_value</span><span class='op'>)</span>, sd <span class='op'>=</span> <span class='va'>sig_tune</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>MH_propose_density</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>jump_to</span>, <span class='va'>jump_from</span>, <span class='va'>sig_tune</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/Lognormal.html'>dlnorm</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>jump_to</span>, meanlog <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>jump_from</span><span class='op'>)</span>, sdlog <span class='op'>=</span> <span class='va'>sig_tune</span><span class='op'>)</span>
<span class='op'>}</span>


<span class='co'>## function to use these to calculate the value of the numerator in Bayes Formula</span>
<span class='co'>## We are working on the LOG scale, so we have to ADD these together</span>
<span class='va'>MH_numerator</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>v</span>, <span class='va'>data</span><span class='op'>)</span>  <span class='op'>{</span>
  <span class='co'># likelihood</span>
  <span class='va'>log_like</span> <span class='op'>&lt;-</span> <span class='fu'>MH_normal_loglike</span><span class='op'>(</span>data_vec <span class='op'>=</span> <span class='va'>data</span>, sd_value <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span>
  <span class='co'># prior</span>
  <span class='va'>log_prior</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>dgamma</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>v</span>, shape <span class='op'>=</span> <span class='fl'>4</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span>, rate <span class='op'>=</span> <span class='fl'>4</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>log_like</span> <span class='op'>+</span> <span class='va'>log_prior</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## function to calculate the acceptance ratio</span>
<span class='va'>MH_accept_probability</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>new_value</span>, <span class='va'>old_value</span>, 
                               <span class='va'>data_to_use</span>, 
                               <span class='va'>tune_parameter</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='co'># working on the LOG scale so we SUBTRACT values (the same as dividing these two things)</span>
  <span class='va'>new</span> <span class='op'>&lt;-</span> <span class='fu'>MH_numerator</span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>new_value</span>, data <span class='op'>=</span> <span class='va'>data_to_use</span><span class='op'>)</span>
  <span class='va'>old</span> <span class='op'>&lt;-</span> <span class='fu'>MH_numerator</span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>old_value</span>, data <span class='op'>=</span> <span class='va'>data_to_use</span><span class='op'>)</span>
  
  <span class='va'>difference_log_scale</span> <span class='op'>&lt;-</span> <span class='va'>new</span> <span class='op'>-</span> <span class='va'>old</span>
  
  <span class='co'># use EXP to undo the LOG</span>
  <span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>difference_log_scale</span><span class='op'>)</span>
  
  <span class='co'># calculate the correction -- asymmetrical proposal</span>
  <span class='va'>new_from_old</span> <span class='op'>&lt;-</span> <span class='fu'>MH_propose_density</span><span class='op'>(</span>jump_to <span class='op'>=</span> <span class='va'>new_value</span>,
                                  jump_from <span class='op'>=</span> <span class='va'>old_value</span>,
                                  sig_tune <span class='op'>=</span> <span class='va'>tune_parameter</span><span class='op'>)</span>
  
  <span class='va'>old_from_new</span> <span class='op'>&lt;-</span> <span class='fu'>MH_propose_density</span><span class='op'>(</span>jump_to <span class='op'>=</span> <span class='va'>old_value</span>,
                                  jump_from <span class='op'>=</span> <span class='va'>new_value</span>,
                                  sig_tune <span class='op'>=</span> <span class='va'>tune_parameter</span><span class='op'>)</span>
  
  <span class='va'>R</span> <span class='op'>&lt;-</span> <span class='va'>r</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>old_from_new</span> <span class='op'>/</span> <span class='va'>new_from_old</span><span class='op'>)</span>
  
  <span class='va'>p_accept</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>R</span><span class='op'>)</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>p_accept</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>The proposal distribution, centered on a value (e.g. <span class="math inline">\(9\)</span>, to pick a random example) should be the same as the proposal density, centered on the same value.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='fl'>3000</span>, <span class='fu'>MH_propose_new_val</span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span>probability <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'>MH_propose_density</span><span class='op'>(</span>jump_to <span class='op'>=</span> <span class='va'>x</span>, jump_from <span class='op'>=</span> <span class='fl'>9</span>, sig_tune <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fl'>14</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-11-1.png" alt="Quick comparison of random proposals, compared to the output of the proposal density function. This shows that the proposal density function is just giving us the probability of different values for the next proposal." width="624" />
<p class="caption">
Figure 3: Quick comparison of random proposals, compared to the output of the proposal density function. This shows that the proposal density function is just giving us the probability of different values for the next proposal.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># set tune parameter</span>
<span class='va'>tune_parameter</span> <span class='op'>&lt;-</span> <span class='fl'>.2</span>
<span class='co'># how long should the chain be? </span>
<span class='va'>n_samples</span> <span class='op'>&lt;-</span> <span class='fl'>5000</span>

<span class='co'>#start chain</span>
<span class='va'>sd_chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_samples</span><span class='op'>)</span>

<span class='co'># start value</span>
<span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>7</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>2</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sd_chain</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='va'>old_val</span> <span class='op'>&lt;-</span> <span class='va'>sd_chain</span><span class='op'>[</span><span class='va'>i</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>]</span>
  
  <span class='va'>new_val</span> <span class='op'>&lt;-</span> <span class='fu'>MH_propose_new_val</span><span class='op'>(</span>old_value <span class='op'>=</span> <span class='va'>old_val</span>, sig_tune <span class='op'>=</span> <span class='va'>tune_parameter</span><span class='op'>)</span>
  
  <span class='va'>p_accept</span> <span class='op'>&lt;-</span> <span class='fu'>MH_accept_probability</span><span class='op'>(</span>new_value <span class='op'>=</span> <span class='va'>new_val</span>,
                                 old_value <span class='op'>=</span> <span class='va'>old_val</span>, 
                                 data_to_use <span class='op'>=</span> <span class='va'>weights</span>,
                                 tune_parameter <span class='op'>=</span> <span class='va'>tune_parameter</span><span class='op'>)</span>
  
  <span class='va'>sd_chain</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='va'>p_accept</span>, <span class='va'>new_val</span>, <span class='va'>old_val</span><span class='op'>)</span>
<span class='op'>}</span>



<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span>, type <span class='op'>=</span> <span class='st'>"l"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-12-1.png" alt="Metropolis Hastings chain for the posterior distribution of a standard deviation. Here we've dropped the burn-in period already. " width="624" />
<p class="caption">
Figure 4: Metropolis Hastings chain for the posterior distribution of a standard deviation. Here we’ve dropped the burn-in period already.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/density.html'>density</a></span><span class='op'>(</span><span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>correct_sd</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 3.072436</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 3.074524</code></pre>
</div>
<p>Close to the true value of <code>correct_sd</code> which is 3.</p>
<div class="blue">
<p>PSA: I made <strong>MANY</strong> errors while I was writing the above. If I had not started with simulated data, I would never have known!! Each time, I compared my answer to <code>correct_sd</code> and then went looking for the errors. Please remember to always do this, especially when you are coding an algorithm yourself!</p>
</div>
<div class="blue">
<p>Experiment with changing the proposal distribution! try for example gamma distribution:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>MH_propose_new_val &lt;-<span class="st"> </span><span class="cf">function</span>(old_value, sig_tune) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="kw">rgamma</span>(<span class="dv">1</span>, <span class="dt">shape =</span> old_value<span class="op">^</span><span class="dv">2</span><span class="op">/</span>sig_tune<span class="op">^</span><span class="dv">2</span>, <span class="dt">rate =</span> old_value<span class="op">/</span>sig_tune<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>}</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>MH_propose_density &lt;-<span class="st"> </span><span class="cf">function</span>(jump_to, jump_from, sig_tune) {</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="kw">dgamma</span>(<span class="dt">x =</span> jump_to, <span class="dt">shape =</span> jump_from<span class="op">^</span><span class="dv">2</span><span class="op">/</span>sig_tune<span class="op">^</span><span class="dv">2</span>, <span class="dt">rate =</span> jump_from<span class="op">/</span>sig_tune<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a>}</span></code></pre></div>
</div>
<h2 id="one-weird-trick-to-make-calculating-the-posterior-easy">One Weird Trick to make calculating the posterior easy</h2>
<h3 id="mean-of-a-normal-distribution">Mean of a Normal Distribution</h3>
<p>model is something like</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Normal}(\mu, 3) \\
\mu &amp;\sim \text{Normal(40, 10)}
\end{align}
\]</span></p>
<p>if the <strong>variance is known</strong>, the posterior for the mean is a Normal distribution:</p>
<p><span class="math display">\[
\mu&#39; \sim \text{Normal}\left(\frac{\frac{m}{s}+ \frac{\sum{y}}{\sigma^2}}{\frac{1}{s^2} + \frac{n}{\sigma^2}}, \left(\frac{1}{s^2} + \frac{n}{\sigma^2}\right)\right)
\]</span></p>
<p>Note that <span class="math inline">\(m\)</span> is the prior mean and <span class="math inline">\(s\)</span> is the prior variance. This is the prior on the parameter <span class="math inline">\(\mu\)</span>, the mean of the distribution of the observations.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>posterior_mean_calculate</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y_vector</span>, <span class='va'>known_sigma</span>,
                      <span class='va'>prior_mean</span>, <span class='va'>prior_sd</span>,
                      <span class='va'>n</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>y_vector</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>numerator_mean</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>prior_mean</span><span class='op'>/</span><span class='va'>prior_sd</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>y_vector</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>known_sigma</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
  <span class='va'>denominator_mean</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>/</span> <span class='va'>prior_sd</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>n</span> <span class='op'>/</span> <span class='va'>known_sigma</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
  
  <span class='va'>new_mean</span> <span class='op'>&lt;-</span>  <span class='va'>numerator_mean</span> <span class='op'>/</span> <span class='va'>denominator_mean</span>
    
  <span class='va'>new_var</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>/</span><span class='va'>denominator_mean</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mean <span class='op'>=</span> <span class='va'>new_mean</span>, sd <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>new_var</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>


<span class='co'>## calculate the posterior distribution of the mean for the weights data</span>
<span class='va'>posterior_parameters</span> <span class='op'>&lt;-</span> <span class='fu'>posterior_mean_calculate</span><span class='op'>(</span><span class='va'>weights</span>, <span class='fl'>3</span>, 
                                                 prior_mean <span class='op'>=</span> <span class='fl'>30</span>, 
                                                 prior_sd <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span>, probability <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='va'>x</span>, 
            mean <span class='op'>=</span> <span class='va'>posterior_parameters</span><span class='op'>$</span><span class='va'>mean</span>, 
            sd <span class='op'>=</span> <span class='va'>posterior_parameters</span><span class='op'>$</span><span class='va'>sd</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-15"></span>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-15-1.png" alt="The Posterior distribution of the mean of a normal distribution. Here we find it two ways: first, using the conjugate prior. Second, using the Metropolis algorithm. You can see that the two are a close match." width="624" />
<p class="caption">
Figure 5: The Posterior distribution of the mean of a normal distribution. Here we find it two ways: first, using the conjugate prior. Second, using the Metropolis algorithm. You can see that the two are a close match.
</p>
</div>
</div>
<h3 id="variance-of-the-normal-distribution">Variance of the Normal Distribution</h3>
<p>First we need to do a little math tweak to the model:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Normal}(50, \sigma) \\
\frac{1}{\sigma^2} &amp;\sim \text{Gamma}\left(\frac{4^2}{3^2}, \frac{4}{3^2}\right)\\
\end{align}
\]</span></p>
<p>Now instead of setting the prior on <span class="math inline">\(\sigma\)</span> directly, we set the prior on the <em>inverse square</em> of sigma!<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>We can think of this as a kind of link function. Doing a bit of algebra, we can see that:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Normal}(50, g^{-1/2}) \\
g &amp;\sim \text{Gamma}\left(\frac{4^2}{3^2}, \frac{4}{3^2}\right)\\
\end{align}
\]</span></p>
<p>I admit that this makes setting reasonable priors awkward, so let’s go back to plotting:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>gs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>5000</span>, <span class='fl'>3.5</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span>, <span class='fl'>3.5</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/density.html'>density</a></span><span class='op'>(</span><span class='va'>gs</span><span class='op'>^</span><span class='op'>-</span><span class='fl'>.5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-16-1.png" width="624" /></p>
</div>
<p>if the mean is known, then the posterior distribution for the variance is an inverse gamma:</p>
<p><span class="math display">\[
\frac{1}{\sigma^2} \sim \text{Gamma}\left(\alpha + \frac{n}{2}, 
\beta + \frac{\sum (y_i - \mu)^2}{2}\right)
\]</span></p>
<p>Another, way less bothersome way to write this is with a related distribution, called the Inverse Gamma:</p>
<p><span class="math display">\[
\sigma^2 \sim \text{InvGamma}\left(\alpha + \frac{n}{2}, 
\beta + \frac{\sum (y_i - \mu)^2}{2}\right)
\]</span></p>
<p>You can convert both precision and varience to the standard deviation with some algebra.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>precision_values</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.09</span>, <span class='fl'>.15</span>, length.out <span class='op'>=</span> <span class='fl'>3000</span><span class='op'>)</span>
<span class='va'>post_density</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>dgamma</a></span><span class='op'>(</span><span class='va'>precision_values</span>, <span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>50</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>weights</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>/</span><span class='fl'>5</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>weights</span> <span class='op'>-</span> <span class='fl'>50</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>precision_values</span><span class='op'>^</span><span class='op'>-</span><span class='fl'>.5</span>, y <span class='op'>=</span> <span class='va'>post_density</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2.5</span>,<span class='fl'>3.5</span><span class='op'>)</span><span class='op'>)</span>

<span class='op'>(</span><span class='va'>precision_values</span><span class='op'>^</span><span class='op'>-</span><span class='fl'>.5</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>post_density</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 3.073139</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>correct_sd</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<p>equivalently:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>variance_values</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>2.5</span>, <span class='fl'>10.5</span>, length.out <span class='op'>=</span> <span class='fl'>3000</span><span class='op'>)</span>
<span class='va'>post_density_invgamma</span> <span class='op'>&lt;-</span> <span class='fu'>extraDistr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extraDistr/man/InvGamma.html'>dinvgamma</a></span><span class='op'>(</span><span class='va'>variance_values</span>,
                                alpha <span class='op'>=</span> <span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>50</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>weights</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>, 
                                beta <span class='op'>=</span> <span class='fl'>2</span><span class='op'>/</span><span class='fl'>5</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>weights</span> <span class='op'>-</span> <span class='fl'>50</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>variance_values</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='va'>post_density_invgamma</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2.5</span>,<span class='fl'>3.5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>posterior_sds</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>sigma <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>2.6</span>,
                                    to <span class='op'>=</span> <span class='fl'>11</span>,
                                    length.out <span class='op'>=</span> <span class='fl'>500</span><span class='op'>)</span>, 
                        density <span class='op'>=</span> <span class='fu'>extraDistr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extraDistr/man/InvGamma.html'>dinvgamma</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>sigma</span>,
                                                        alpha <span class='op'>=</span> <span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>5</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>weights</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>,
                                                        beta <span class='op'>=</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>5</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>weights</span> <span class='op'>-</span> <span class='fl'>50</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>tibble</span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='va'>n_samples</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>v</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_histogram</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>..density..</span><span class='op'>)</span>,
                 binwidth <span class='op'>=</span> <span class='fl'>.2</span>, fill <span class='op'>=</span> <span class='st'>"grey"</span>, color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>sigma</span>, y <span class='op'>=</span> <span class='va'>density</span><span class='op'>)</span>, 
            data <span class='op'>=</span> <span class='va'>posterior_sds</span>,
            col <span class='op'>=</span> <span class='st'>"red"</span>, size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Variance"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-19-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tibble</span><span class='op'>(</span>sigma <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>10</span>, length.out <span class='op'>=</span> <span class='fl'>500</span><span class='op'>)</span>, 
                          density <span class='op'>=</span> <span class='fu'>extraDistr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extraDistr/man/InvGamma.html'>dinvgamma</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>sigma</span>,
                                                          alpha <span class='op'>=</span> <span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>5</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>weights</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>,
                                                          beta <span class='op'>=</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>5</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>weights</span> <span class='op'>-</span> <span class='fl'>50</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>sigma</span>, y <span class='op'>=</span> <span class='va'>density</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-20-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'>extraDistr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extraDistr/man/InvGamma.html'>dinvgamma</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>,
                      alpha <span class='op'>=</span> <span class='fl'>200</span>,
                      beta <span class='op'>=</span> <span class='fl'>.1</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-20-2.png" width="624" /></p>
</div>
<h2 id="gibbs-sampling">Gibbs sampling</h2>
<div style="width:100%;height:0;padding-bottom:61%;position:relative;">
<iframe src="https://giphy.com/embed/3oEhmHmWP3Y9wQxoli" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen>
</iframe>
</div>
<p>
<a href="https://giphy.com/gifs/funny-lol-cartoon-3oEhmHmWP3Y9wQxoli">via GIPHY</a>
</p>
<p>Gibbs sampling is like knitting. Imagine you have several parameters and you’re going to take posterior samples for each one.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vals</span> <span class='op'>&lt;-</span> <span class='fu'>expand_grid</span><span class='op'>(</span>y <span class='op'>=</span> <span class='fl'>5</span><span class='op'>:</span><span class='fl'>1</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>

<span class='va'>pnames</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"beta[0]"</span>, <span class='st'>"beta[1]"</span>, <span class='st'>"sigma"</span><span class='op'>)</span>

<span class='va'>vals</span> <span class='op'>&lt;-</span> <span class='fu'>mutate</span><span class='op'>(</span><span class='va'>vals</span>, 
               par <span class='op'>=</span> <span class='va'>pnames</span><span class='op'>[</span><span class='va'>x</span><span class='op'>]</span><span class='op'>)</span>

<span class='va'>out_list</span> <span class='op'>&lt;-</span> <span class='fu'>map</span><span class='op'>(</span><span class='fl'>3</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>vals</span><span class='op'>)</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/transform.html'>transform</a></span><span class='op'>(</span><span class='va'>vals</span>, s <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>0</span><span class='op'>)</span>, times <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>.x</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>vals</span><span class='op'>)</span><span class='op'>-</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>out_list</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_pad.html'>str_pad</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>out_list</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>2</span>, pad <span class='op'>=</span> <span class='st'>"0"</span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gganimate.com'>gganimate</a></span><span class='op'>)</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>out_list</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bind_rows</span><span class='op'>(</span>.id <span class='op'>=</span> <span class='st'>"sim"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, width <span class='op'>=</span> <span class='fl'>1</span>, height <span class='op'>=</span> <span class='fl'>1</span>, fill <span class='op'>=</span> <span class='va'>s</span>, label <span class='op'>=</span> <span class='va'>par</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_tile</span><span class='op'>(</span>col <span class='op'>=</span> <span class='st'>"black"</span>, lwd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_text</span><span class='op'>(</span>parse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>theme_void</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://gganimate.com/reference/transition_states.html'>transition_states</a></span><span class='op'>(</span><span class='va'>sim</span>,  transition_length <span class='op'>=</span> <span class='fl'>0</span>, state_length <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='fu'><a href='https://gganimate.com/reference/animate.html'>animate</a></span><span class='op'>(</span><span class='va'>p</span>, nframes <span class='op'>=</span> <span class='fl'>15</span><span class='op'>)</span>  
</code></pre>
</div>
</div>
<p>In this simple animation, each column is a parameter and each row is an iteration of the model.</p>
<p>Gibbs sampling works by simplifying a multivariate problem into small steps and tackling each one. We consider that all the parameters are known except the one we are sampling right now. Then, we sample form the posterior distribution for that parameter. This sampling can be done by conjugate posteriors, as we did above. It can also be done with the Metropolis or Metropolis-Hastings algorithm, or even with a combination of the two!</p>
<p>The steps for this algorithm are similar to the previous ones:</p>
<ol type="1">
<li>Start with random values for each parameter.</li>
<li>assuming that all are correct except the first, sample a value for the first.</li>
<li>Assuming that sample was correct for the first, sample the second.</li>
</ol>
<h3 id="gibbs-demo-with-the-normal-distribution">Gibbs demo with the Normal Distribution</h3>
<p>Let’s begin by simulating some values from a normal distribution:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>true_mean</span> <span class='op'>&lt;-</span> <span class='fl'>31</span>
<span class='va'>true_sd</span> <span class='op'>&lt;-</span>  <span class='fl'>4</span>
<span class='va'>sample_size</span> <span class='op'>&lt;-</span> <span class='fl'>30</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1859</span><span class='op'>)</span>
<span class='va'>mass_values</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>sample_size</span>, mean <span class='op'>=</span> <span class='va'>true_mean</span>, sd <span class='op'>=</span> <span class='va'>true_sd</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>mass_values</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-22-1.png" width="624" /></p>
</div>
<p>We define a model for these data. We do this in a very deliberate way, choosing the priors to be conjugates:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Normal}(\mu, \sigma) \\
\mu &amp;\sim \text{Normal}(10,5) \\
\frac{1}{\sigma^2} &amp;\sim \text{Gamma}(4.1^2/2^2, 4.1/2^2)
\end{align}
\]</span></p>
<p>Why did I choose the mean of 4.5 for the gamma distribution? What is a gamma distribution anyway, and what does this strange link function mean?</p>
<p>As usual, simulation is a great way to understand and practice.</p>
<p>Let’s start by simulating values with a mean of</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>1000</span>, shape <span class='op'>=</span> <span class='fl'>4.1</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span>, rate <span class='op'>=</span> <span class='fl'>4.1</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>rg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 4.019667</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>rg</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1.903422</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>dgamma</a></span><span class='op'>(</span><span class='va'>x</span>, shape <span class='op'>=</span> <span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span>, rate <span class='op'>=</span> <span class='fl'>3</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-23-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/density.html'>density</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='va'>rg</span><span class='op'>^</span><span class='fl'>.5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-23-2.png" width="624" /></p>
</div>
<h3 id="defining-and-running-a-gibbs-sampler">Defining and running a Gibbs Sampler</h3>
<p>To implement this model we need to write functions that will do each of these things in turn.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate the posterior normal distribution for the data and a known variance</span>

<span class='va'>post_mean</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y_vector</span>, <span class='va'>known_sigma</span>,
                      <span class='va'>prior_mean</span>, <span class='va'>prior_sd</span>,
                      <span class='va'>n</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>y_vector</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>numerator_mean</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>prior_mean</span><span class='op'>/</span><span class='va'>prior_sd</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>y_vector</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>known_sigma</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
  <span class='va'>denominator_mean</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>/</span> <span class='va'>prior_sd</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>n</span> <span class='op'>/</span> <span class='va'>known_sigma</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
  
  <span class='va'>new_mean</span> <span class='op'>&lt;-</span>  <span class='va'>numerator_mean</span> <span class='op'>/</span> <span class='va'>denominator_mean</span>
    
  <span class='va'>new_var</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>/</span><span class='va'>denominator_mean</span>
  
  <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, mean <span class='op'>=</span> <span class='va'>new_mean</span>, sd <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>new_var</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># fun to play with this! make sure it makes sense! </span>
<span class='fu'>post_mean</span><span class='op'>(</span>y_vector <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>1</span>,<span class='fl'>5</span><span class='op'>)</span>, <span class='fl'>.1</span>, <span class='fl'>7</span>, <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2.984141</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>post_sd</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y_vector</span>, <span class='va'>known_mean</span>, <span class='va'>prior_alpha</span>, <span class='va'>prior_beta</span><span class='op'>)</span><span class='op'>{</span>
  
  <span class='va'>new_alpha</span> <span class='op'>&lt;-</span> <span class='va'>prior_alpha</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>y_vector</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span>
  
  <span class='va'>new_beta</span> <span class='op'>&lt;-</span> <span class='va'>prior_beta</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>y_vector</span> <span class='op'>-</span> <span class='va'>known_mean</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span>
  
  <span class='va'>inverse_variance</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>1</span>, shape <span class='op'>=</span> <span class='va'>new_alpha</span>, rate <span class='op'>=</span> <span class='va'>new_beta</span><span class='op'>)</span>
  
  <span class='va'>sd_sample</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='va'>inverse_variance</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>sd_sample</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>post_sd</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>1</span>,<span class='fl'>5</span><span class='op'>)</span>, known_mean <span class='op'>=</span> <span class='fl'>3</span>, prior_alpha <span class='op'>=</span> <span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span>, prior_beta <span class='op'>=</span> <span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1.126258</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>1</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1.825742</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>true_mean</span> <span class='op'>&lt;-</span> <span class='fl'>24</span>
<span class='va'>true_sd</span> <span class='op'>&lt;-</span> <span class='fl'>7</span>

<span class='va'>y_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>400</span>, mean <span class='op'>=</span> <span class='va'>true_mean</span>, sd <span class='op'>=</span> <span class='va'>true_sd</span><span class='op'>)</span>

<span class='co'># gibbs process</span>
<span class='va'>n_iterations</span> <span class='op'>&lt;-</span> <span class='fl'>2000</span>
<span class='va'>mean_chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_iterations</span><span class='op'>)</span>
<span class='va'>sd_chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_iterations</span><span class='op'>)</span>


<span class='co'># sample to start -- could be anything, might as well be priors</span>
<span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, mean <span class='op'>=</span> <span class='fl'>10</span>, sd <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
<span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>1</span>, shape <span class='op'>=</span> <span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span>, rate <span class='op'>=</span> <span class='fl'>3</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>2</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># draw a mean</span>
  <span class='va'>mean_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>post_mean</span><span class='op'>(</span>y_vector <span class='op'>=</span> <span class='va'>y_data</span>,
                             known_sigma <span class='op'>=</span> <span class='va'>sd_chain</span><span class='op'>[</span><span class='va'>k</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>]</span>,
                             prior_mean <span class='op'>=</span> <span class='fl'>10</span>,
                             prior_sd <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
  <span class='va'>sd_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>post_sd</span><span class='op'>(</span>y_vector <span class='op'>=</span> <span class='va'>y_data</span>, 
                         known_mean <span class='op'>=</span> <span class='va'>mean_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span>,
                         prior_alpha <span class='op'>=</span> <span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span>,
                         prior_beta <span class='op'>=</span> <span class='fl'>3</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h <span class='op'>=</span> <span class='va'>true_mean</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, lwd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>sd_chain</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h <span class='op'>=</span> <span class='va'>true_sd</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, lwd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-26-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>You can see that the chains are almost exactly what we want.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='va'>x</span>, mean <span class='op'>=</span> <span class='va'>true_mean</span>, sd <span class='op'>=</span> <span class='va'>true_sd</span><span class='op'>)</span>,
      xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>true_mean</span> <span class='op'>-</span> <span class='fl'>4</span> <span class='op'>*</span> <span class='va'>true_sd</span>,
               <span class='va'>true_mean</span> <span class='op'>+</span> <span class='fl'>4</span> <span class='op'>*</span> <span class='va'>true_sd</span><span class='op'>)</span>, 
      lwd <span class='op'>=</span> <span class='fl'>8</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.07</span><span class='op'>)</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='op'>(</span><span class='va'>n_iterations</span><span class='op'>-</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='va'>x</span>, mean <span class='op'>=</span> <span class='va'>mean_chain</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, sd <span class='op'>=</span> <span class='va'>sd_chain</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-27-1.png" width="624" /></p>
</div>
<p>Are the posterior medians close to the real values?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 24.22588</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>true_mean</span>
</code></pre>
</div>
<pre><code>[1] 24</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 7.153504</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>true_sd</span>
</code></pre>
</div>
<pre><code>[1] 7</code></pre>
</div>
<p>Play with these values and see if you can break this algorithm.</p>
<p>We can also look at the pairs plot, like this</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mean_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>]</span>, <span class='va'>sd_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-29-1.png" width="624" /></p>
</div>
<p>This reveals if there are any correlations in the posterior.</p>
<h2 id="metropolis-in-gibbs">Metropolis-in-Gibbs</h2>
<p>Sometimes we need a Deluxe option – running a Metropolis Hastings sampler inside a Gibbs sampler</p>
<p>Let’s look at an example where that is necessary</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{LogNormal}(\text{log}) \\
\end{align}
\]</span></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>truemean</span> <span class='op'>&lt;-</span> <span class='fl'>15</span>
<span class='va'>truesd</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>


<span class='va'>ff</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Lognormal.html'>rlnorm</a></span><span class='op'>(</span><span class='fl'>2000</span>,
             meanlog <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>.5</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>, 
             sdlog <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>.5</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 15.03566</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2.99522</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<p>conjugacy and the lognormal</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># mean 2 sd = 3</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='va'>x</span>, 
            mean <span class='op'>=</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>20</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='fl'>20</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>,
            sd <span class='op'>=</span> <span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='fl'>20</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>^</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,
      xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>10</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-31-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>dgamma</a></span><span class='op'>(</span><span class='va'>x</span>, 
             shape <span class='op'>=</span> <span class='fl'>3</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>,
             rate <span class='op'>=</span> <span class='fl'>4</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span> <span class='op'>-</span> <span class='va'>truemean</span> <span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>.01</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-32-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.1111111</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ml</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>.5</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>dgamma</a></span><span class='op'>(</span><span class='va'>x</span>, 
             shape <span class='op'>=</span> <span class='fl'>3</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>,
             rate <span class='op'>=</span> <span class='fl'>4</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span> <span class='op'>-</span> <span class='va'>ml</span> <span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>40</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='fl'>1</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-33-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># mean 2 sd = 3</span>

<span class='va'>truemean</span> <span class='op'>&lt;-</span> <span class='fl'>20</span>
<span class='va'>truesd</span> <span class='op'>&lt;-</span> <span class='fl'>9</span>
<span class='va'>meanlog</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>.5</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
<span class='va'>sdlog</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>.5</span>

<span class='co'>#this sdlog thing is so weird!</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>truemean</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>.5</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>200</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-34-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ff</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Lognormal.html'>rlnorm</a></span><span class='op'>(</span><span class='fl'>300</span>,
             meanlog <span class='op'>=</span> <span class='va'>meanlog</span>, 
             sdlog <span class='op'>=</span> <span class='va'>sdlog</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>ff</span>, probability <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-34-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 8.398296</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'>extraDistr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extraDistr/man/InvGamma.html'>dinvgamma</a></span><span class='op'>(</span><span class='va'>x</span>, 
                            alpha <span class='op'>=</span> <span class='fl'>3</span> ,
                            beta <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
      xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>5</span><span class='op'>)</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'>extraDistr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extraDistr/man/InvGamma.html'>dinvgamma</a></span><span class='op'>(</span><span class='va'>x</span>, 
                            alpha <span class='op'>=</span> <span class='fl'>3</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>,
                            beta <span class='op'>=</span> <span class='fl'>4</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>ff</span><span class='op'>)</span> <span class='op'>-</span> <span class='va'>meanlog</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>,
      add <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>sdlog</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-34-3.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'>extraDistr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/extraDistr/man/InvGamma.html'>dinvgamma</a></span><span class='op'>(</span><span class='va'>x</span>, 
                            alpha <span class='op'>=</span> <span class='fl'>3</span>,
                            beta <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>truesd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-35-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fl'>4</span> <span class='op'>*</span> <span class='va'>x</span> <span class='op'>^</span> <span class='op'>(</span><span class='fl'>.2</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>300</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-36-1.png" width="624" /></p>
</div>
<ul>
<li>some kind of decerating power curve</li>
<li>one of the parameters is probably less than 1 but not less than 0</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>true_sd</span> <span class='op'>&lt;-</span> <span class='fl'>4</span>
<span class='va'>true_value_at_one</span> <span class='op'>&lt;-</span>  <span class='fl'>2</span>
<span class='va'>true_exponent</span> <span class='op'>&lt;-</span> <span class='fl'>.5</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tibble.tidyverse.org/'>tibble</a></span><span class='op'>)</span>

<span class='va'>energy_mass</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
  masses <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>200</span>, min <span class='op'>=</span> <span class='fl'>2</span>, max <span class='op'>=</span> <span class='fl'>320</span><span class='op'>)</span>,
  avg_energy <span class='op'>=</span> <span class='va'>true_value_at_one</span><span class='op'>*</span><span class='va'>masses</span><span class='op'>^</span><span class='va'>true_exponent</span>,
  energies <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Lognormal.html'>rlnorm</a></span><span class='op'>(</span><span class='fl'>200</span>,
                    meanlog <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>avg_energy</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>.5</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avg_energy</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>true_sd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>avg_energy</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>, 
                    sdlog <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>avg_energy</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>true_sd</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='va'>avg_energy</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>.5</span><span class='op'>)</span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>

<span class='va'>energy_mass</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>masses</span>, y <span class='op'>=</span> <span class='va'>energies</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-37-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h1 id="bonus-zone">Bonus Zone</h1>
<h2 id="conjugate-priors-metropolis-hastings-and-penguins">Conjugate priors, Metropolis-Hastings, and Penguins</h2>
<h3 id="proof-of-beta-binomial-conjugate-pair">Proof of Beta &amp; Binomial conjugate pair</h3>
<p><span class="math display">\[
\begin{align}
[p|\text{trials}, \text{successes}, \alpha, \beta] &amp;\propto [\text{successes} | \text{trials}, p] \times [p | \alpha , \beta]\\
&amp;\propto \text{Binomial}(p,\text{trials}) \times \text{Beta}(\alpha, \beta)\\
&amp;\propto{\text{trials} \choose \text{successes}}p^\text{successes}(1-p)^{\text{trials}-\text{successes}} \times \text{B} p^{\alpha - 1}(1-p)^{\beta - 1}\\
&amp;\propto p^\text{successes}(1-p)^{\text{trials}-\text{successes}} \times p^{\alpha - 1}(1-p)^{\beta - 1}\\
&amp;\propto p^{\alpha + \text{successes} - 1}(1-p)^{ \beta + \text{trials}-\text{successes} - 1}
\end{align}
\]</span></p>
<p>Now we only have to realize that the last line is a beta distribution, without the magic number that we called “<span class="math inline">\(B\)</span>” before. This value is what’s called a “normalizing constant”. Normalizing constants make the proportional expression (like the one above) into a probability distribution</p>
<aside>
remember that probability distributions sum to 1. So we just need to divide by some magic number that makes the whole thing, whatever it is, sum to 1. That magic number is our normalizing constant
</aside>
<p><span class="math display">\[
[p|\text{trials}, \text{successes}, \alpha, \beta] = \text{Beta}(\alpha + \text{successes} - 1, \beta + \text{trials}-\text{successes} - 1)
\]</span></p>
<p>So the posterior distribution is a Beta distribution, just like the prior was! We have it already, with no need for any fancy sampling approach.</p>
<p>This also gives us an easy interpretation of what the parameters of any Beta distribution are: <span class="math inline">\(\alpha\)</span> is something like the number of successes, and <span class="math inline">\(\beta\)</span> is something like the number of failures<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>Suppose we had written the model like this:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Binomial}(p, N) \\
\text{logit}(p)  &amp;= \alpha\\ 
\alpha &amp;\sim \text{Normal}(1, 1)
\end{align}
\]</span></p>
<p>Remember that the binomial distribution is written as:</p>
<p><span class="math display">\[
{n \choose k} p^k (1-p)^{n-k}
\]</span></p>
<p>the two lines in equation 1 are just a shorthand for saying “replace <span class="math inline">\(p\)</span> with the inverse logit of <span class="math inline">\(\alpha\)</span>”. We could also write it this way, literally replacing <span class="math inline">\(p\)</span> with that function</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim {n \choose k} \left(\frac{e^\alpha}{1 + e^\alpha} \right)^{k}\left(1-\frac{e^\alpha}{1 + e^\alpha}\right)^{n-k} \\
\alpha &amp;\sim \text{Normal}(1, 1)
\end{align}
\]</span></p>
<p>Another quick reminder, remember that the logistic function is a traditional way of squishing any real number into the interval <span class="math inline">\((0,1)\)</span>:</p>
<p><span class="math display">\[
\frac{e^x}{1 + e^x}
\]</span></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>,
      xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>4</span>, <span class='fl'>4</span><span class='op'>)</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-39-1.png" width="624" /></p>
</div>
<p>Let’s imagine an experiment where we place exactly 42 seeds in experimental plots. We use 30 experimental plots.</p>
<p>We want to estimate a probability of germination for these seedlings</p>
<p>Our model looks like this:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Binomial}(p_{\text{survival}}, 42)\\
p_{\text{survival}} &amp;\sim \text{Beta}(2,5)\\
\end{align}
\]</span></p>
<p>in English, this means:</p>
<ul>
<li>We thing that the number of seedlings which germinate will follow a Binomial distribution. This means that out of a total of 42, some survive. The probability for any surviving is the same: <span class="math inline">\(p_{\text{survival}}\)</span></li>
<li></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## start with some survival data -- out of 42</span>
<span class='va'>true_prob</span> <span class='op'>&lt;-</span> <span class='fl'>0.7</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1859</span><span class='op'>)</span>
<span class='va'>n_surviving</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>300</span>, size <span class='op'>=</span> <span class='fl'>42</span>, prob <span class='op'>=</span> <span class='va'>true_prob</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>n_surviving</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>42</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-40-1.png" width="624" /></p>
</div>
<p>Can use the conjugate posterior.</p>
<p>First, use the conjugate prior to the binomial (beta distribution).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>2</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-41-1.png" width="624" /></p>
</div>
<p>This might be a reasonable first guess. But what does it actually mean? we need to do predictions to make sure.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>possible_probabilities</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>rbeta</a></span><span class='op'>(</span><span class='fl'>300</span>, <span class='fl'>2</span>, <span class='fl'>5</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='fl'>30</span>, <span class='fl'>42</span>, <span class='va'>possible_probabilities</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>42</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-42-1.png" width="624" /></p>
</div>
<p>Do this a bunch of times, to see if the prior is foolish or not.</p>
<p>With enough data, even an outlandish prior is fine:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lived</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n_surviving</span><span class='op'>)</span>
<span class='va'>died</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fl'>42</span> <span class='op'>-</span> <span class='va'>n_surviving</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>calculate the posterior</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>2</span>, <span class='fl'>5</span><span class='op'>)</span>,ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>2</span> <span class='op'>+</span> <span class='va'>lived</span>, <span class='fl'>5</span> <span class='op'>+</span> <span class='va'>died</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>true_prob</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span><span class='op'>(</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>lived</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>lived</span> <span class='op'>+</span> <span class='fl'>5</span> <span class='op'>+</span> <span class='va'>died</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-44-1.png" width="624" /></p>
</div>
<h3 id="sampling-this-model-the-metropolis-algorithm">Sampling this model: the Metropolis algorithm</h3>
<p>Once again, our model is:</p>
<p><span class="math display">\[
\begin{align}
y &amp;\sim \text{Binomial}(p, N) \\
\text{logit}(p)  &amp;= \alpha\\ 
\alpha &amp;\sim \text{Normal}(1, 1)
\end{align}
\]</span></p>
<p>Now we have no conjugate posterior for <span class="math inline">\(\alpha\)</span>. However, just because we can’t calculate the distribution doesn’t mean we can’t sample it!</p>
<p>We can use the Metropolis algorithm.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## define likelihoods for our problem</span>
<span class='va'>binomial_loglike</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data_vec</span>, <span class='va'>prob_new</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>dbinom</a></span><span class='op'>(</span><span class='va'>data_vec</span>, size <span class='op'>=</span> <span class='fl'>42</span>, 
             prob <span class='op'>=</span> <span class='va'>prob_new</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>normal_loglike</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>val</span>, <span class='va'>mean_prior</span>, <span class='va'>sd_prior</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='va'>val</span>, mean <span class='op'>=</span> <span class='va'>mean_prior</span>, sd <span class='op'>=</span> <span class='va'>sd_prior</span>, log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>}</span>


<span class='co'># define our function</span>
<span class='va'>logistic_curve</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## function to use these to calculate the value of the numerator in Bayes Formula</span>
<span class='va'>numerator</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>v</span>, <span class='va'>data</span><span class='op'>)</span>  <span class='op'>{</span>
  <span class='fu'>binomial_loglike</span><span class='op'>(</span>data_vec <span class='op'>=</span> <span class='va'>data</span>, prob_new <span class='op'>=</span> <span class='fu'>logistic_curve</span><span class='op'>(</span><span class='va'>v</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
    <span class='fu'>normal_loglike</span><span class='op'>(</span>val <span class='op'>=</span> <span class='va'>v</span>, mean <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>, sd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## function to calculate the acceptance ratio</span>
<span class='va'>accept_probability</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>new_value</span>, <span class='va'>old_value</span>, <span class='va'>data_to_use</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='fu'>numerator</span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>new_value</span>, data <span class='op'>=</span> <span class='va'>data_to_use</span><span class='op'>)</span> <span class='op'>-</span> 
        <span class='fu'>numerator</span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>old_value</span>, data <span class='op'>=</span> <span class='va'>data_to_use</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='va'>p_accept</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='va'>r</span><span class='op'>)</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>p_accept</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># proposal function to make new parameter values.</span>
<span class='va'>propose_new</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>sig_tune</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, mean <span class='op'>=</span> <span class='va'>x</span>, sd <span class='op'>=</span> <span class='va'>sig_tune</span><span class='op'>)</span>

<span class='co'># start value</span>
<span class='va'>metropolis</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>dataset</span>,
                       <span class='va'>n_samples</span>,
                       <span class='va'>tune_parameter</span>,
                       <span class='va'>start_value</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_samples</span><span class='op'>)</span>
  
  <span class='va'>chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>start_value</span>
  
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>2</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>chain</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    
    <span class='va'>old</span> <span class='op'>&lt;-</span> <span class='va'>chain</span><span class='op'>[</span><span class='va'>i</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>]</span>
    
    <span class='va'>new</span> <span class='op'>&lt;-</span> <span class='fu'>propose_new</span><span class='op'>(</span><span class='va'>old</span>, sig_tune <span class='op'>=</span> <span class='va'>tune_parameter</span><span class='op'>)</span>
    
    <span class='va'>p_accept</span> <span class='op'>&lt;-</span> <span class='fu'>accept_probability</span><span class='op'>(</span>new_value <span class='op'>=</span> <span class='va'>new</span>,
                                   old_value <span class='op'>=</span> <span class='va'>old</span>, 
                                   data_to_use <span class='op'>=</span> <span class='va'>dataset</span><span class='op'>)</span>
    
    <span class='va'>chain</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='va'>p_accept</span>, <span class='va'>new</span>, <span class='va'>old</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>chain</span><span class='op'>)</span>
<span class='op'>}</span>


<span class='va'>chain</span> <span class='op'>&lt;-</span> <span class='fu'>metropolis</span><span class='op'>(</span>dataset <span class='op'>=</span> <span class='va'>n_surviving</span>,
                    n_samples <span class='op'>=</span> <span class='fl'>3000</span>,
                    tune_parameter <span class='op'>=</span> <span class='fl'>0.2</span>, 
                    start_value <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='fl'>3000</span><span class='op'>]</span>, type <span class='op'>=</span> <span class='st'>"l"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-45-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>chain</span><span class='op'>[</span><span class='fl'>300</span><span class='op'>:</span><span class='fl'>5000</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-46-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>chain</span><span class='op'>[</span><span class='fl'>200</span><span class='op'>:</span><span class='fl'>5000</span><span class='op'>]</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.6</span>,<span class='fl'>.9</span><span class='op'>)</span>, probability <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>true_prob</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>2</span> <span class='op'>+</span> <span class='va'>lived</span>, <span class='fl'>5</span> <span class='op'>+</span> <span class='va'>died</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-47-1.png" width="624" /></p>
</div>
<h3 id="application-clutch-success-in-the-palmer-penguins">Application: Clutch success in the Palmer Penguins</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='fu'><a href='https://allisonhorst.github.io/palmerpenguins/reference/path_to_file.html'>path_to_file</a></span><span class='op'>(</span><span class='st'>"penguins_raw.csv"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>penguins_raw</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>Species</span>, <span class='va'>`Clutch Completion`</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='va'>`Clutch Completion`</span>, values_from <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Species</th>
<th style="text-align: right;">No</th>
<th style="text-align: right;">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adelie Penguin (Pygoscelis adeliae)</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">138</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chinstrap penguin (Pygoscelis antarctica)</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gentoo penguin (Pygoscelis papua)</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">116</td>
</tr>
</tbody>
</table>
</div>
<p>With this, we can calculate the posterior probability of clutch success for each penguin species.</p>
<p><span class="math display">\[
\begin{align}
n_{\text{succeeded}} &amp;\sim \text{Binomial}(p_{\text{success}}, n_{\text{nesting}})\\
p_{\text{success}} &amp;\sim \text{Beta}(7,3)\\
\end{align}
\]</span></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>7</span>, <span class='fl'>3</span><span class='op'>)</span>, ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>17</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>138</span> <span class='op'>+</span> <span class='fl'>7</span>, <span class='fl'>14</span> <span class='op'>+</span> <span class='fl'>3</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>54</span> <span class='op'>+</span> <span class='fl'>7</span>, <span class='fl'>14</span> <span class='op'>+</span> <span class='fl'>3</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span>, lty <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>dbeta</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>116</span> <span class='op'>+</span> <span class='fl'>7</span>, <span class='fl'>8</span> <span class='op'>+</span> <span class='fl'>3</span><span class='op'>)</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span>, lty <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>17</span>, legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"prior"</span>, <span class='st'>"Adelie"</span>, <span class='st'>"Chinstrap"</span>, <span class='st'>"Gentoo"</span><span class='op'>)</span>, lty <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-49-1.png" width="624" /></p>
</div>
<h2 id="three-parameters-at-once">Three parameters at once</h2>
<p>Imagine that you are doing a simple linear regression and you want to get three parameters: the slope, the intercept, and the variance of the observations.</p>
<p>We perform the same procedure, looking for gibbs samples where we can.</p>
<p><tk write model definiton> &lt;tk use DAGS to draw the models?&gt;</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>n_invented</span> <span class='op'>&lt;-</span> <span class='fl'>300</span>
<span class='va'>x_invented</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>n_invented</span>, <span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span> 

<span class='va'>true_intercept</span> <span class='op'>&lt;-</span> <span class='fl'>50</span>
<span class='va'>true_slope</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>

<span class='va'>true_observation_sd</span> <span class='op'>&lt;-</span> <span class='fl'>1.5</span>

<span class='va'>y_invented</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='va'>n_invented</span>, 
                    mean <span class='op'>=</span> <span class='va'>true_intercept</span> <span class='op'>+</span> <span class='va'>true_slope</span><span class='op'>*</span><span class='va'>x_invented</span>, 
                    sd <span class='op'>=</span> <span class='va'>true_observation_sd</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x_invented</span>, <span class='va'>y_invented</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-50-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># gibbs process</span>
<span class='va'>n_iterations</span> <span class='op'>&lt;-</span> <span class='fl'>2000</span>
<span class='va'>b0_chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_iterations</span><span class='op'>)</span>
<span class='va'>b1_chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_iterations</span><span class='op'>)</span>
<span class='va'>observation_sd_chain</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span><span class='op'>(</span><span class='va'>n_iterations</span><span class='op'>)</span>


<span class='co'># sample to start -- could be anything, might as well be priors</span>
<span class='va'>b0_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, mean <span class='op'>=</span> <span class='fl'>10</span>, sd <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
<span class='va'>b1_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, mean <span class='op'>=</span> <span class='fl'>0</span>, sd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>observation_sd_chain</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>1</span>, shape <span class='op'>=</span> <span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span>, rate <span class='op'>=</span> <span class='fl'>3</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>2</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># draw a mean</span>
  <span class='va'>b0_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>post_mean</span><span class='op'>(</span>
    y_vector <span class='op'>=</span> <span class='va'>y_invented</span> <span class='op'>-</span> <span class='va'>x_invented</span> <span class='op'>*</span> <span class='va'>b1_chain</span><span class='op'>[</span><span class='va'>k</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>]</span>,
    known_sigma <span class='op'>=</span> <span class='va'>observation_sd_chain</span><span class='op'>[</span><span class='va'>k</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>]</span>,
    prior_mean <span class='op'>=</span> <span class='fl'>10</span>,
    prior_sd <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
  <span class='va'>b1_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>post_mean</span><span class='op'>(</span>
    y_vector <span class='op'>=</span> <span class='op'>(</span><span class='va'>y_invented</span> <span class='op'>-</span> <span class='va'>b0_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>)</span><span class='op'>*</span><span class='va'>x_invented</span>,
    known_sigma <span class='op'>=</span> <span class='va'>observation_sd_chain</span><span class='op'>[</span><span class='va'>k</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>]</span>,
    prior_mean <span class='op'>=</span> <span class='fl'>0</span>,
    prior_sd <span class='op'>=</span> <span class='fl'>2</span>, 
    n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x_invented</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>observation_sd_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>post_sd</span><span class='op'>(</span>
    y_vector <span class='op'>=</span> <span class='va'>y_invented</span>, 
    known_mean <span class='op'>=</span> <span class='va'>b0_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>x_invented</span> <span class='op'>*</span> <span class='va'>b1_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span>,
    prior_alpha <span class='op'>=</span> <span class='fl'>3</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span>,
    prior_beta <span class='op'>=</span> <span class='fl'>3</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>b0_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h <span class='op'>=</span> <span class='va'>true_intercept</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, lwd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>b1_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h <span class='op'>=</span> <span class='va'>true_slope</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, lwd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>observation_sd_chain</span><span class='op'>[</span><span class='fl'>100</span><span class='op'>:</span><span class='va'>n_iterations</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h <span class='op'>=</span> <span class='va'>true_observation_sd</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, lwd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-51-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># plot these regression lines</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x_invented</span>, <span class='va'>y_invented</span><span class='op'>)</span>

<span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>200</span><span class='op'>:</span><span class='fl'>220</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>a <span class='op'>=</span> <span class='va'>b0_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span>, b <span class='op'>=</span> <span class='va'>b1_chain</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-52-1.png" width="624" /></p>
</div>
<p>could also plot some interesting posterior predictive plots in this way.</p>
<h2 id="metropolis-hastings-and-gibbs-at-the-same-time">Metropolis hastings and gibbs at the same time</h2>
<p>Sometimes you will have a model for which you can’t (or don’t want to) use conjugate posteriors for each of the conditional distributions.</p>
<h2 id="clara-coffee-example">Clara Coffee Example</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>clara_coffee</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>Coffee_extraction</span>, <span class='op'>~</span><span class='va'>time</span>,
  <span class='fl'>15.88</span>,              <span class='fl'>19.13875598</span>,
  <span class='fl'>16.72</span>,              <span class='fl'>7.633587786</span>,
  <span class='fl'>16.72</span>,              <span class='fl'>22.90076336</span>,
  <span class='fl'>17</span>,                       <span class='fl'>30</span>,
  <span class='fl'>17.3</span>,              <span class='fl'>5.479452055</span>,
  <span class='fl'>17.64</span>,              <span class='fl'>12.93103448</span>,
  <span class='fl'>17.75</span>,              <span class='fl'>9.459459459</span>,
  <span class='fl'>17.77</span>,              <span class='fl'>12.93103448</span>,
  <span class='fl'>17.99</span>,              <span class='fl'>10.18867925</span>,
  <span class='fl'>18</span>,                        <span class='fl'>6</span>,
  <span class='fl'>18.03</span>,              <span class='fl'>11.86440678</span>,
  <span class='fl'>18.32</span>,              <span class='fl'>15.54404145</span>,
  <span class='fl'>18.57</span>,              <span class='fl'>23.71794872</span>,
  <span class='fl'>18.89</span>,              <span class='fl'>24.75247525</span>,
  <span class='fl'>19.13</span>,                      <span class='fl'>6.4</span>,
  <span class='fl'>19.33</span>,              <span class='fl'>20.30456853</span>,
  <span class='fl'>19.36</span>,              <span class='fl'>18.71345029</span>,
  <span class='fl'>19.5</span>,              <span class='fl'>33.49282297</span>,
  <span class='fl'>19.67</span>,              <span class='fl'>13.61867704</span>,
  <span class='fl'>20.23</span>,              <span class='fl'>15.81027668</span>,
  <span class='fl'>20.26</span>,              <span class='fl'>17.54385965</span>,
  <span class='fl'>20.39</span>,              <span class='fl'>13.76146789</span>,
  <span class='fl'>20.45</span>,              <span class='fl'>14.93775934</span>,
  <span class='fl'>20.57</span>,              <span class='fl'>13.61867704</span>,
  <span class='fl'>20.61</span>,              <span class='fl'>14.85148515</span>,
  <span class='fl'>20.69</span>,                <span class='fl'>39.408867</span>,
  <span class='fl'>20.76</span>,              <span class='fl'>6.944444444</span>,
  <span class='fl'>20.84</span>,              <span class='fl'>8.968609865</span>,
  <span class='fl'>20.88</span>,              <span class='fl'>11.40684411</span>,
  <span class='fl'>20.95</span>,              <span class='fl'>9.756097561</span>,
  <span class='fl'>21.04</span>,              <span class='fl'>4.843304843</span>,
  <span class='fl'>21.2</span>,               <span class='fl'>14.0969163</span>,
  <span class='fl'>21.25</span>,                     <span class='fl'>15.2</span>,
  <span class='fl'>21.36</span>,              <span class='fl'>6.060606061</span>,
  <span class='fl'>21.72</span>,              <span class='fl'>11.52073733</span>,
  <span class='fl'>21.86</span>,              <span class='fl'>10.89494163</span>,
  <span class='fl'>22.14</span>,              <span class='fl'>8.849557522</span>,
  <span class='fl'>22.26</span>,              <span class='fl'>8.532423208</span>,
  <span class='fl'>22.47</span>,              <span class='fl'>13.39285714</span>,
  <span class='fl'>22.48</span>,              <span class='fl'>5.333333333</span>,
  <span class='fl'>23.48</span>,              <span class='fl'>6.134969325</span>,
  <span class='fl'>24.29</span>,              <span class='fl'>6.993006993</span>,
  <span class='fl'>24.35</span>,               <span class='fl'>7.86163522</span>,
  <span class='fl'>24.63</span>,              <span class='fl'>12.95336788</span>
<span class='op'>)</span>


<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>

<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>clara_coffee</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>time</span>, y <span class='op'>=</span> <span class='va'>Coffee_extraction</span><span class='op'>/</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-53-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#' what are the response distribution?</span>
<span class='co'>#'</span>
<span class='co'>#' what is the question?</span>

<span class='co'>#' quel est la relation entre la coulée d'eau et lextraction de cafe</span>
<span class='co'>#'</span>

<span class='co'># response distribtuion -- between 0 and 1. Could be the beta.</span>

<span class='co'># normal -- for pragmatic reasons ?</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>dgamma</a></span><span class='op'>(</span><span class='va'>x</span>, shape <span class='op'>=</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>4</span>, rate <span class='op'>=</span> <span class='fl'>2</span><span class='op'>/</span><span class='fl'>4</span><span class='op'>)</span>, xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="gibbs_review_files/figure-html5/unnamed-chunk-53-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sigma_coffee</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>1</span>, shape <span class='op'>=</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fl'>4</span>, rate <span class='op'>=</span> <span class='fl'>2</span><span class='op'>/</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mean_coffee</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>21</span>, <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>change_coffee</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>clara_coffee</span><span class='op'>$</span><span class='va'>t_centered</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>clara_coffee</span>, <span class='va'>time</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>time</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>clara_coffee_prior</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/transform.html'>transform</a></span><span class='op'>(</span><span class='va'>clara_coffee</span>,
                                average_measure <span class='op'>=</span> <span class='va'>mean_coffee</span> <span class='op'>+</span>
                                  <span class='va'>change_coffee</span><span class='op'>*</span><span class='va'>t_centered</span><span class='op'>)</span>

<span class='va'>clara_coffee_prior</span><span class='op'>$</span><span class='va'>fake_obs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>clara_coffee</span><span class='op'>)</span>,
                                     mean <span class='op'>=</span> <span class='va'>clara_coffee_prior</span><span class='op'>$</span><span class='va'>average_measure</span>,
                                     sd <span class='op'>=</span> <span class='va'>sigma_coffee</span><span class='op'>)</span>


<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>clara_coffee_prior</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Coffee_extraction</span>, y <span class='op'>=</span> <span class='va'>fake_obs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="gibbs_review_files/figure-html5/unnamed-chunk-53-3.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/paul-buerkner/brms'>brms</a></span><span class='op'>)</span>

<span class='va'>coffee_formula</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula.html'>bf</a></span><span class='op'>(</span><span class='va'>Coffee_extraction</span> <span class='op'>~</span> <span class='va'>t_centered</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/brms/man/get_prior.html'>get_prior</a></span><span class='op'>(</span><span class='va'>coffee_formula</span>, data <span class='op'>=</span> <span class='va'>clara_coffee_prior</span><span class='op'>)</span>

<span class='va'>cafe_stan</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>Coffee_extraction</span> <span class='op'>~</span> <span class='va'>t_centered</span>,
                     data <span class='op'>=</span> <span class='va'>clara_coffee_prior</span>, <span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>except for the Normal distribution. The Normal is a beautiful weirdo which is why we love it!<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Why do we do the inverse square? Well, the square of the standard deviation is the variance. As we know, the larger the variance, the wider the distribution. The inverse variance has the opposite interpretation: the larger it is, the more narrow and focussed the distribution! This is called the “precision”, and it is another common way to think about the Normal Distribution.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Not EXACTLY successes and failures because <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> can be decimal numbers (e.g. “1.5”) and obviously real successes and failures can’t be. You can think of these as “pseudosuccesses” and “pseudofailures” or, as I prefer, “successosity” and “failishness” <a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
